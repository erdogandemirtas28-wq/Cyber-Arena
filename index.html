<!DOCTYPE html>
<html>
<head>
    <title>Dragon Arena Mobile</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; color: #fff; touch-action: none; }
        #overlay { position: fixed; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; text-align: center; }
        .selection-box { display: flex; gap: 10px; margin: 10px; }
        .opt { width: 40px; height: 40px; border: 2px solid #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; border-radius: 10px; }
        .selected { border-color: #0ff; box-shadow: 0 0 10px #0ff; }
        #ad-container { position: absolute; bottom: 0; width: 100%; height: 60px; background: #222; display: none; }
    </style>
</head>
<body>

<div id="overlay">
    <h1 style="color:#0ff">DRAGON ARENA</h1>
    <input type="text" id="nameInp" placeholder="Ejderha AdÄ±" maxlength="10" style="padding:10px; border-radius:10px;">
    
    <p>RENK SEÃ‡</p>
    <div class="selection-box" id="colors">
        <div class="opt selected" style="background:#ff4444" data-val="#ff4444"></div>
        <div class="opt" style="background:#44ff44" data-val="#44ff44"></div>
        <div class="opt" style="background:#4444ff" data-val="#4444ff"></div>
    </div>

    <p>GÃ–RÃœNÃœM SEÃ‡</p>
    <div class="selection-box" id="skins">
        <div class="opt selected" data-val="ğŸ²">ğŸ²</div>
        <div class="opt" data-val="ğŸ‰">ğŸ‰</div>
        <div class="opt" data-val="ğŸ¦–">ğŸ¦–</div>
    </div>

    <button id="startBtn" style="padding:15px 40px; background:#0ff; border:none; border-radius:20px; font-weight:bold; margin-top:20px;">SAVAÅA KATIL</button>
</div>

<div id="ad-container">
    <ins class="adsbygoogle" style="display:inline-block;width:320px;height:50px" data-ad-client="ca-pub-XXXXXXXX" data-ad-slot="XXXXXXX"></ins>
</div>

<div id="ui" style="position:fixed; top:20px; left:20px; font-size:20px; color:#0ff;">ENERJÄ°: <span id="puan">0</span></div>

<canvas id="gameCanvas"></canvas>

<script src="/socket.io/socket.io.js"></script>
<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const socket = io();
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;

    let state = { players: {}, foods: [], bullets: [] };
    let localPos = { x: 1500, y: 1500 };
    let myColor = "#ff4444", mySkin = "ğŸ²";

    // SeÃ§im MantÄ±ÄŸÄ±
    document.querySelectorAll('#colors .opt').forEach(o => o.onclick = () => {
        document.querySelectorAll('#colors .opt').forEach(i => i.classList.remove('selected'));
        o.classList.add('selected'); myColor = o.dataset.val;
    });
    document.querySelectorAll('#skins .opt').forEach(o => o.onclick = () => {
        document.querySelectorAll('#skins .opt').forEach(i => i.classList.remove('selected'));
        o.classList.add('selected'); mySkin = o.dataset.val;
    });

    document.getElementById('startBtn').onclick = () => {
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('ad-container').style.display = 'none';
        socket.emit('joinGame', { name: document.getElementById('nameInp').value, color: myColor, skin: mySkin });
    };

    socket.on('playerDied', () => {
        document.getElementById('overlay').style.display = 'flex';
        document.getElementById('ad-container').style.display = 'block'; // Ã–ldÃ¼ÄŸÃ¼nde reklamÄ± gÃ¶ster
        (adsbygoogle = window.adsbygoogle || []).push({});
    });

    // Ã‡izim DÃ¶ngÃ¼sÃ¼ (Ejderha Ã‡izimi)
    function draw() {
        ctx.fillStyle = "#000"; ctx.fillRect(0,0,canvas.width, canvas.height);
        const me = state.players[socket.id];
        if(me && me.isAlive) {
            // Hareket MantÄ±ÄŸÄ± (Daha Ã¶nceki hÄ±zlandÄ±rÄ±lmÄ±ÅŸ kod)
            ctx.save();
            ctx.translate(canvas.width/2 - me.x, canvas.height/2 - me.y);
            
            // EjderhalarÄ± Ã‡iz
            for(let id in state.players) {
                let p = state.players[id];
                if(!p.isAlive) continue;

                ctx.save();
                ctx.translate(p.x, p.y);
                ctx.rotate(p.angle);
                
                // Ejderha GÃ¶vdesi (Parlayan Halka)
                ctx.shadowBlur = 20; ctx.shadowColor = p.color;
                ctx.fillStyle = p.color + "55";
                ctx.beginPath(); ctx.arc(0,0, p.radius, 0, Math.PI*2); ctx.fill();
                
                // Ejderha KafasÄ± (Emoji/GÃ¶rÃ¼nÃ¼m)
                ctx.shadowBlur = 0;
                ctx.font = (p.radius * 1.5) + "px serif";
                ctx.textAlign = "center"; ctx.textBaseline = "middle";
                ctx.fillText(p.skin, 0, 0); 
                
                ctx.restore();
                
                ctx.fillStyle = "#fff"; ctx.fillText(p.name, p.x, p.y - p.radius - 10);
            }
            ctx.restore();
        }
        requestAnimationFrame(draw);
    }
    socket.on('updateState', s => state = s);
    draw();
</script>
</body>
</html>